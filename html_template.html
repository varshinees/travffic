<!DOCTYPE html>
<html>
<head>
<title>Travis Traffic</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdFS4Aau71yIFvTCoQzH4bQqxMOk5jni4&libraries=places&callback=initMap">
</script>
<style>
  html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}

  .myGallery {
    display: grid;
    grid-gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }

  .myGallery img {
    width: 100%;
    height: 100%;
  }

  .myGallery .item {
    position: relative;
    overflow: hidden;
  }

  .myGallery .item img {
    vertical-align: middle;
  }

  .myGallery .caption {
    margin: 0;
    padding: 1em;
    position: absolute;
    z-index: 1;
    bottom: 0;
    left: 0;
    width: 100%;
    max-height: 100%;
    overflow: auto;
    box-sizing: border-box;
    transition: transform .5s;
    transform: translateY(100%);
    background: rgba(0, 0, 0, .7);
    color: rgb(255, 255, 255);
  }

  .myGallery .item:hover .caption {
    transform: translateY(0%);
  }
</style>
</head>

<body class="w3-light-grey">

<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i> Â Menu</button>
  <span class="w3-bar-item w3-right">Logo</span>
  <div id="ww_81047790d57d6" v='1.20' loc='id' a='{"t":"ticker","lang":"en","ids":["wl1433"],"cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722","sl_sot":"fahrenheit","sl_ics":"one_a","font":"Arial","el_nme":3}'>Weather for the Following Location: <a href="https://2ua.org/usa/austin/map/" id="ww_81047790d57d6_u" target="_blank">Austin on Map</a></div><script async src="https://srv2.weatherwidget.org/js/?id=ww_81047790d57d6"></script>
</div>
<br/>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-top:43px;">
  <!-- Header -->
  <header class="w3-container" style="padding-top:22px">
    <h5><b><i class="fa fa-dashboard"></i>Travis Traffic Dashboard</b></h5>
  </header>

  <div class="w3-container">
    <div class="w3-row w3-padding-16">
      <input class="w3-input" type="text" id="start" placeholder= "Starting address">
      <input class="w3-input" type="text" placeholder= "Destination">
      <br/>
      <button class="w3-button w3-dark-grey" onclick="getCameras()">Check Route <i class="fa fa-arrow-right"></i></button>
    </div>
  </div>

  <div class="w3-panel">
    <div class="w3-row-padding" style="margin:0 -16px">
      <!-- PLACE FOR IMAGES -->
      <div class="w3-twothird">
        <h5>Route</h5>
        <div class="myGallery" id="myGallery"></div>

      </div>
      <div class="w3-third">
        <h5>Weather Forecast</h5>
        <div id="ww_54d60479b968f" v='1.20' loc='id' a='{"t":"horizontal","lang":"en","ids":["wl1433"],"cl_bkg":"image","cl_font":"#FFFFFF","cl_cloud":"#FFFFFF","cl_persp":"#81D4FA","cl_sun":"#FFC107","cl_moon":"#FFC107","cl_thund":"#FF5722","sl_sot":"fahrenheit","sl_ics":"one_a","font":"Arial","el_nme":3}'>Weather for the Following Location: <a href="https://2ua.org/usa/austin/map/" id="ww_54d60479b968f_u" target="_blank">Austin on Map</a></div><script async src="https://srv2.weatherwidget.org/js/?id=ww_54d60479b968f"></script>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer class="w3-container w3-padding-16 w3-light-grey">
    <h4>FOOTER</h4>
    <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
  </footer>

  <!-- End page content -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

let autocomplete;
function initMap() {
  autocomplete = new google.maps.places.Autocomplete(
       document.getElementById("start"),
      {
        componentRestrictions: {'country': ['US']},
        fields: ['place_id', 'geometry', 'name']
      });

  autocomplete.addListener('place_changed', onPlaceChanged);
}

let place;
function onPlaceChanged() {
  place = autocomplete.getPlace();

  if (!place.geometry) {
    document.getElementById("start").placeholder = "Enter your starting location";
  }
}

function getCameras() {
  if (!place) 
    return;
  // console.log(place.geometry.location.lng())
  fetch("https://data.austintexas.gov/resource/b4k4-adkb.json?$where=within_circle(location, " + 
    place.geometry.location.lat() + ", " +
    place.geometry.location.lng() + ", 500)")
    //uncomment line below and comment line above to more cameras at once
    //place.geometry.location.lng() + ", 2000)")


  .then(response => {
    // indicates whether the response is successful (status code 200-299) or not
    if (!response.ok) {
      console.log(`Request failed with status ${response.status}`)
    }
    return response.json()
  })
  .then(data => {
    let gallery = document.getElementById('myGallery');
    gallery.innerHTML = " "
    for (const i in data) {
        // THIS IS THE LOCATION FOR THE GALLERY
        gallery.innerHTML += "<div class=\"item\"> <img src=" + data[i]['screenshot_address'] + "  width=\"40%\" height=\"40%\"/>"
              + " <span class=\"caption\">" + data[i]['location_name'] + "</span> </div>";
      
    }
  })
  .catch(error => console.log(error))

}


</script>

</body>
</html>
